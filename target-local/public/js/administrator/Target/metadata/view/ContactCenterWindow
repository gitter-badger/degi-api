{
    "type": "Ext.window.Window",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "container|align": "stretch",
        "container|padding": "10 10 10 10",
        "designer|userAlias": "contactcenterwindow",
        "designer|userClassName": "ContactCenterWindow",
        "height": null,
        "id": "contactcenterWindow",
        "layout": "vbox",
        "modal": true,
        "title": "My Window",
        "width": null
    },
    "name": "ReportWindow1",
    "designerId": "2e1e8beb-a18d-4c06-94d1-ca74b8aa8f55",
    "viewControllerInstanceId": "99b29ff6-5faf-4de0-a2cc-9c9a420fae7f",
    "viewModelInstanceId": "65c6218b-a899-4a88-aca4-27ca0b351a58",
    "cn": [
        {
            "type": "Ext.form.field.Hidden",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fieldLabel": "Label",
                "id": "cc_id",
                "name": null
            },
            "name": "MyHiddenField",
            "designerId": "c89d6c19-cf6f-4bcd-b59b-5cd62603b70f"
        },
        {
            "type": "Ext.container.Container",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "container|pack": "end",
                "id": "mainContainter",
                "layout": "hbox",
                "layout|flex": 1
            },
            "name": "MyContainer2",
            "designerId": "ffa45b36-e6da-4515-a8a8-b5bc03397038",
            "cn": [
                {
                    "type": "Ext.form.Panel",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "bodyPadding": 10,
                        "container|align": "stretch",
                        "id": "contactcenterForm",
                        "layout": "vbox",
                        "layout|flex": 1,
                        "title": ""
                    },
                    "name": "MyForm",
                    "designerId": "32c6c05a-1928-4c85-83eb-8558313b8ea9",
                    "cn": [
                        {
                            "type": "Ext.form.field.Display",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fieldLabel": "主旨",
                                "layout|flex": 1,
                                "name": "cc_subject"
                            },
                            "name": "MyDisplayField",
                            "designerId": "4fbe0491-3387-4ca2-bc5d-7d6c4188e8c1"
                        },
                        {
                            "type": "Ext.form.field.TextArea",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "editable": false,
                                "fieldLabel": "內容",
                                "height": 200,
                                "layout|flex": 1,
                                "name": "cc_content"
                            },
                            "name": "MyTextArea2",
                            "designerId": "fd78f455-b79b-40a3-9a2c-d9ca31b07d58"
                        },
                        {
                            "type": "Ext.form.field.Hidden",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fieldLabel": "處理狀況",
                                "height": null,
                                "id": "cc_status",
                                "layout|flex": 1,
                                "name": "cc_status"
                            },
                            "name": "MyHiddenField1",
                            "designerId": "ba71250f-8d05-45f8-b333-dcfa3b6f4833"
                        }
                    ]
                },
                {
                    "type": "Ext.container.Container",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "id": "imgContainer",
                        "layout|flex": 1,
                        "margin": "43 0 0 0",
                        "width": 200
                    },
                    "name": "MyContainer1",
                    "designerId": "95d34180-874f-440e-b0a9-9273b5af0f43",
                    "cn": [
                        {
                            "type": "Ext.Img",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "height": 201,
                                "id": "cc_uploadpic",
                                "width": 200
                            },
                            "name": "MyImg",
                            "designerId": "45c58e05-411d-4459-83d5-efdb03a4abcb",
                            "cn": [
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onCc_uploadpicRender",
                                        "implHandler": [
                                            "Ext.fly(this.el).on('dblclick', function(e, t){",
                                            "    var img = Ext.getCmp('cc_uploadpic').getEl().dom.src;",
                                            "    window.open(img);",
                                            "});",
                                            ""
                                        ],
                                        "name": "render",
                                        "scope": "me"
                                    },
                                    "name": "onCc_uploadpicRender",
                                    "designerId": "c8833d3d-ac0c-47ea-881b-9e553a4b6f88"
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.container.Container",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "layout|flex": 1,
                "padding": "0 0 0 10"
            },
            "name": "MyContainer",
            "designerId": "bc14db60-c101-4bee-b92e-a8f5e40cff84",
            "cn": [
                {
                    "type": "Ext.form.field.Text",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "emptyText": "open／close ...",
                        "fieldLabel": "status",
                        "id": "ccStatus1Value"
                    },
                    "name": "MyTextField4",
                    "designerId": "bdefbdcb-1c0c-43d7-b6ac-3ecb18592933"
                },
                {
                    "type": "Ext.form.field.TextArea",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "emptyText": "處理中／已結案 ...",
                        "fieldLabel": "note",
                        "fieldStyle": null,
                        "height": 90,
                        "id": "ccStatus2Value",
                        "labelAlign": null,
                        "style": null,
                        "width": 400
                    },
                    "name": "MyTextArea1",
                    "designerId": "23a9338c-1d0f-4e11-95b3-5c07c2e1d923"
                }
            ]
        },
        {
            "type": "Ext.toolbar.Toolbar",
            "reference": {
                "name": "dockedItems",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "container|pack": "end",
                "dock": "bottom"
            },
            "name": "MyToolbar3",
            "designerId": "316a6b11-d32c-4cd0-9efe-644402b2a9ec",
            "cn": [
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": null,
                        "text": "修改"
                    },
                    "name": "MyButton6",
                    "designerId": "e0199f13-5738-4f09-aff2-43831bd604f0",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onButtonClick",
                                "implHandler": [
                                    "var ccStatus = {};",
                                    "var ccKeyArray = [];",
                                    "var ccValueArray = [];",
                                    "",
                                    "var ccStatusNumber = 2; //如果加欄位就改這個值，兩欄就改2, 三欄就改3, 以此類推。",
                                    "",
                                    "for(var i=1; i<=ccStatusNumber; i++){",
                                    "    var fieldName = Ext.getCmp('ccStatus'+i+'Value').fieldLabel;",
                                    "    var fieldValue = Ext.getCmp('ccStatus'+i+'Value').getValue();",
                                    "",
                                    "    ccKeyArray.push(fieldName);",
                                    "    ccValueArray.push(fieldValue);",
                                    "}",
                                    "",
                                    "if( ccKeyArray.length === ccValueArray.length ){",
                                    "    for(var aLen=0; aLen<ccKeyArray.length; aLen++){",
                                    "        ccStatus[ccKeyArray[aLen]] = ccValueArray[aLen];",
                                    "    }",
                                    "}",
                                    "",
                                    "// console.log('ccStatus: '+ccStatus);",
                                    "// console.log('ccStatus: '+Ext.JSON.encode(ccStatus));",
                                    "var ccStatusJson = Ext.JSON.encode(ccStatus);",
                                    "// console.log('ccStatusJson: '+ccStatusJson);",
                                    "",
                                    "var form = Ext.getCmp('contactcenterForm').getForm();",
                                    "",
                                    "if(form.isValid()){",
                                    "    var ccId = Ext.getCmp('cc_id').getValue();",
                                    "    form.findField('cc_status').setValue(ccStatusJson);",
                                    "    form.submit({",
                                    "        // params: Ext.util.JSON.encode(form.getValues()),",
                                    "        method: 'PUT',",
                                    "        waitTitle:'訊息',",
                                    "        waitMsg:'修改資料中',",
                                    "        url:'http://dev.finpo.com.tw/posh/public/b/contactcenter/'+ccId,",
                                    "",
                                    "        success:function(form,action){",
                                    "",
                                    "            var store  = Ext.getCmp('contactcentergridpanel').getViewModel().getStore('ContactCenterStore');",
                                    "            store.proxy.url='http://dev.finpo.com.tw/posh/public/b/contactcenter';",
                                    "            store.load();",
                                    "",
                                    "            form.reset();",
                                    "            Ext.Msg.alert('訊息','回報資料修改成功', function(){",
                                    "                var window = Ext.getCmp('contactcenterWindow');",
                                    "                window.close();",
                                    "            });",
                                    "",
                                    "        },",
                                    "        failure:function(form,action){",
                                    "",
                                    "           Ext.Msg.alert('訊息','回報資料修改失敗');",
                                    "",
                                    "        }",
                                    "",
                                    "    });",
                                    "}"
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "name": "onButtonClick",
                            "designerId": "4c1e7f20-a0d3-4423-913b-c10ef0520ece"
                        }
                    ]
                }
            ]
        },
        {
            "type": "basiceventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onWindowAfterRender",
                "implHandler": [
                    "// var baseURL = 'http://dev.finpo.com.tw/posh/public/'; /* 本機用這個，上線前註解掉 */",
                    "var baseURL = document.URL;",
                    "",
                    "var ccId = Ext.getCmp('cc_id').getValue();",
                    "",
                    "Ext.Ajax.request({",
                    "    url: 'http://dev.finpo.com.tw/posh/public/b/contactcenter/'+ccId,",
                    "    success: function(response, opts){",
                    "        var obj = Ext.decode(response.responseText);",
                    "",
                    "        Ext.getCmp('contactcenterForm').getForm().setValues(obj.data);",
                    "",
                    "        var ccStatus = Ext.getCmp('cc_status').getValue();",
                    "        var ccStatusObj = '';",
                    "        if(ccStatus !== ''){",
                    "            ccStatusObj = Ext.JSON.decode(ccStatus);",
                    "        }",
                    "",
                    "        /* 塞值給 img 元件 */",
                    "        if(obj.data.cc_uploadpic !== ''){",
                    "            Ext.getCmp('cc_uploadpic').getEl().dom.src = baseURL+'../images/contact/'+obj.data.cc_uploadpic;",
                    "        }",
                    "",
                    "        var len = 0;",
                    "        if(ccStatusObj !== ''){",
                    "            for( var key in ccStatusObj ){",
                    "                len++;",
                    "                var objKey = key;",
                    "                Ext.getCmp('ccStatus'+len+'Value').labelEl.update(key);",
                    "                Ext.getCmp('ccStatus'+len+'Value').setValue(ccStatusObj[key]);",
                    "            }",
                    "        }",
                    "",
                    "    },",
                    "    failure: function(response, opts){",
                    "        console.log('server-side failure with status code ' + response.status);",
                    "    }",
                    "});"
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "name": "onWindowAfterRender",
            "designerId": "63d61dfb-fe78-4faa-9bc7-8c5274485b27"
        }
    ]
}